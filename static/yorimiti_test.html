<!DOCTYPE html>
{% load staticfiles %}
{% load rest_framework %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
	<!-- CSS読み込み -->
	<!--<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">-->
	<!--<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">-->
	<link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <!--<script type="text/javascript" src="{{STATIC_URL}}js/jquery-1.11.0.min.js"></script>-->
    <script type="text/javascript" src="https://raw.githubusercontent.com/juniskw/django_tools/master/csrf_token_ajax.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>
<body>
		<h1>サンプル画面
		</h1>

		<p id="msg">カテゴリを選択してください。
		</p>
		<form id="surprise_fm" action="" method="GET">
			<div id="select-box">
				<select id="sports" name="hoge">
				  <option>{{ m_category.0.category_name }}</option>
				  <!-- jinja2を利用してループさせる -->
			  	  {% for object in m_category %}
      					  <option>{{ object.sub_category_name }}</option>
    				{% endfor %}
				</select>
			</div>
			<br/>
			{% csrf_token %}
        	<button id ="button1" value="検索" />検索</button>
    	</form>
		<br/>
		API取得結果(category_name): <input type="text" id="result" value=""><br>
		<button id ="retrieve" style="background-color: #66FFAA;"/>GET API</button>
		<br/>
		<br/>
		<form id="radio_form" action="search" method="GET">
			<input type="radio" id="radio" name="example" value="スポーツ">スポーツ
    	</form>
		API取得結果(category_name): <input type="text" id="result2" value=""><br>
        <button id ="button2" value="検索" />検索</button>
		<br/>
		<br/>
		</p>
		<!-- 地図に表示 -->
		<div class="map-wrapper">
			<div id="map-canvas"></div>
		</div>

		<table border="brwsr1">
			<Tr>
				<Th id="th1">No.</Th>
				<Th id="th2">店舗・施設</Th>
			</Tr>
			<Tr>
				<Td id="td1">1</Td>
				<Td id="td2"><a href="sample.html" title="">井の頭　恩腸公園</a></Td>
			</Tr>
			<Tr>
				<Td id="td1">2</Td>
				<Td id="td2"><a href="sample.html" title="">鎌田公園</a></Td>
			</Tr>
		</table>
		<br>
		<div id="footer">
			<p id="copyright">Copyright (c) training_scrum Inc. All Rights Reserved.</p>
		</div>
</body>
<script>
$('#retrieve').click(function() {
 	$('#result').val('成功');
});
$('#retrieve').click(function() {
	if($('#sports').val() == 'スポーツ') {
		$('#result').val('サブカテを選択してください');
  	}
    $.ajax({
        'url':'../search/' + $('#sports').val(),
        'type':'GET',
        'data':{},
        'dataType':'json',
        'success':function(response){
            $('#result').val(response.category_name);
        },
    });
    <!--$('#result').val('失敗');-->
    return false;
});
</script>
<script>
<!--$('#button2').click(function() {-->
 	<!--$('#result').val('成功');-->
<!--});-->

$('#button2').click(function() {
    $.ajax({
        'url':'../radio_search/' + $('#radio').val(),
        'type':'GET',
        'data':{},
        'dataType':'json',
        'success':function(response){
            $('#result2').val(
            response[0].sub_category_name + ':' +
            response[1].sub_category_name + ':' +
            response[2].sub_category_name);
        },
    });
    $('#result2').val('失敗');
    return false;
});
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGkTT-OCucXTF5kLkOKTTFKeCC4ljEExE"></script>

<script>
/********************************************************************************

	SYNCER 〜 知識、感動をみんなと同期(Sync)するブログ

	* 配布場所
	https://syncer.jp/how-to-use-geolocation-api

	* 最終更新日時
	2015/08/16 03:17

	* 作者
	あらゆ

	** 連絡先
	Twitter: https://twitter.com/arayutw
	Facebook: https://www.facebook.com/arayutw
	Google+: https://plus.google.com/114918692417332410369/
	E-mail: info@syncer.jp

	※ バグ、不具合の報告、提案、ご要望など、お待ちしております。
	※ 申し訳ありませんが、ご利用者様、個々の環境における問題はサポートしていません。

********************************************************************************/


// ユーザーの端末がGeoLocation APIに対応しているかの判定

// 対応している場合
if( navigator.geolocation )
{
	// 現在地を取得
	navigator.geolocation.getCurrentPosition(

		// [第1引数] 取得に成功した場合の関数
		function( position )
		{
			// 取得したデータの整理
			var data = position.coords ;

			// データの整理
			var lat = data.latitude ;
			var lng = data.longitude ;
			var alt = data.altitude ;
			var accLatlng = data.accuracy ;
			var accAlt = data.altitudeAccuracy ;
			var heading = data.heading ;			//0=北,90=東,180=南,270=西
			var speed = data.speed ;

			// アラート表示
//			alert( "あなたの現在位置は、\n[" + lat + "," + lng + "]\nです。" ) ;

			// HTMLへの書き出し
			document.getElementById( 'result' ).innerHTML = '<dl><dt>緯度</dt><dd>' + lat + '</dd><dt>経度</dt><dd>' + lng + '</dd><dt>高度</dt><dd>' + alt + '</dd><dt>緯度、経度の精度</dt><dd>' + accLatlng + '</dd><dt>高度の精度</dt><dd>' + accAlt + '</dd><dt>方角</dt><dd>' + heading + '</dd><dt>速度</dt><dd>' + speed + '</dd></dl>' ;

			// 位置情報
			var latlng = new google.maps.LatLng( lat , lng ) ;

			// Google Mapsに書き出し
			var map = new google.maps.Map( document.getElementById( 'map-canvas' ) , {
				zoom: 15 ,				// ズーム値
				center: latlng ,		// 中心座標 [latlng]
			} ) ;

			// マーカーの新規出力
			new google.maps.Marker( {
				map: map ,
				position: latlng ,
			} ) ;
		},

		// [第2引数] 取得に失敗した場合の関数
		function( error )
		{
			// エラーコード(error.code)の番号
			// 0:UNKNOWN_ERROR				原因不明のエラー
			// 1:PERMISSION_DENIED			利用者が位置情報の取得を許可しなかった
			// 2:POSITION_UNAVAILABLE		電波状況などで位置情報が取得できなかった
			// 3:TIMEOUT					位置情報の取得に時間がかかり過ぎた…

			// エラー番号に対応したメッセージ
			var errorInfo = [
				"原因不明のエラーが発生しました…。" ,
				"位置情報の取得が許可されませんでした…。" ,
				"電波状況などで位置情報が取得できませんでした…。" ,
				"位置情報の取得に時間がかかり過ぎてタイムアウトしました…。"
			] ;

			// エラー番号
			var errorNo = error.code ;

			// エラーメッセージ
			var errorMessage = "[エラー番号: " + errorNo + "]\n" + errorInfo[ errorNo ] ;

			// アラート表示
			alert( errorMessage ) ;

			// HTMLに書き出し
			document.getElementById("result").innerHTML = errorMessage;
		} ,

		// [第3引数] オプション
		{
			"enableHighAccuracy": false,
			"timeout": 8000,
			"maximumAge": 2000,
		}

	) ;
}

// 対応していない場合
else
{
	// エラーメッセージ
	var errorMessage = "お使いの端末は、GeoLacation APIに対応していません。" ;

	// アラート表示
	alert( errorMessage ) ;

	// HTMLに書き出し
	document.getElementById( 'result' ).innerHTML = errorMessage ;
}

</script>

</html>